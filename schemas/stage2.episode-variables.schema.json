{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://narrative-vox/schemas/stage2.episode-variables.schema.json",
  "title": "Stage2 Episode Variables",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "meta",
    "episode_constraints",
    "core_points",
    "variables",
    "quality_checks",
    "continuity_checks"
  ],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "book_title",
        "episode_id",
        "episode_title",
        "chapter_theme",
        "audience_background",
        "audience_level",
        "audience_interest",
        "baseline_context_or_empty",
        "existing_audio_script_dir_or_empty",
        "comparison_mode"
      ],
      "properties": {
        "book_title": {
          "type": "string",
          "minLength": 1
        },
        "episode_id": {
          "type": "string",
          "pattern": "^E[0-9]{2}$"
        },
        "episode_title": {
          "type": "string",
          "minLength": 1
        },
        "chapter_theme": {
          "type": "string",
          "minLength": 1
        },
        "audience_background": {
          "type": "string"
        },
        "audience_level": {
          "type": "string"
        },
        "audience_interest": {
          "type": "string"
        },
        "baseline_context_or_empty": {
          "type": "string"
        },
        "existing_audio_script_dir_or_empty": {
          "type": "string"
        },
        "comparison_mode": {
          "type": "string",
          "enum": [
            "with_baseline",
            "standalone"
          ]
        }
      }
    },
    "episode_constraints": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "target_theme_ids",
        "source_refs",
        "scope_guardrails",
        "learning_goal"
      ],
      "properties": {
        "target_theme_ids": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "pattern": "^T[0-9]{2}$"
          }
        },
        "source_refs": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "scope_guardrails": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "learning_goal": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "core_points": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "variables": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "prerequisite_context",
        "baseline_context_or_empty",
        "baseline_pattern",
        "common_problem_1",
        "common_problem_2",
        "target_approach",
        "what_it_models",
        "can_handle_explicitly",
        "intentionally_out_of_scope",
        "base_model",
        "target_model",
        "decision_scenario",
        "practical_benefit",
        "review_or_process_change",
        "maintainability_or_risk_impact",
        "what_to_decide_early",
        "applicability_scope",
        "out_of_scope_summary"
      ],
      "properties": {
        "prerequisite_context": {
          "type": "string"
        },
        "baseline_context_or_empty": {
          "type": "string"
        },
        "baseline_pattern": {
          "type": "string"
        },
        "common_problem_1": {
          "type": "string"
        },
        "common_problem_2": {
          "type": "string"
        },
        "target_approach": {
          "type": "string"
        },
        "what_it_models": {
          "type": "string"
        },
        "can_handle_explicitly": {
          "type": "string"
        },
        "intentionally_out_of_scope": {
          "type": "string"
        },
        "base_model": {
          "type": "string"
        },
        "target_model": {
          "type": "string"
        },
        "decision_scenario": {
          "type": "string"
        },
        "practical_benefit": {
          "type": "string"
        },
        "review_or_process_change": {
          "type": "string"
        },
        "maintainability_or_risk_impact": {
          "type": "string"
        },
        "what_to_decide_early": {
          "type": "string"
        },
        "applicability_scope": {
          "type": "string"
        },
        "out_of_scope_summary": {
          "type": "string"
        }
      }
    },
    "quality_checks": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "blueprint_alignment",
        "source_coverage",
        "audio_suitability",
        "missing_fields"
      ],
      "properties": {
        "blueprint_alignment": {
          "type": "string",
          "enum": [
            "OK",
            "NG"
          ]
        },
        "source_coverage": {
          "type": "string",
          "enum": [
            "OK",
            "NG"
          ]
        },
        "audio_suitability": {
          "type": "string",
          "enum": [
            "OK",
            "NG"
          ]
        },
        "missing_fields": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "continuity_checks": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "existing_audio_script_dir",
        "existing_topics",
        "overlap_risk",
        "differentiation_points"
      ],
      "properties": {
        "existing_audio_script_dir": {
          "type": "string"
        },
        "existing_topics": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "overlap_risk": {
          "type": "string",
          "enum": [
            "LOW",
            "MEDIUM",
            "HIGH",
            "N/A"
          ]
        },
        "differentiation_points": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
