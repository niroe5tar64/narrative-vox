{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://narrative-vox/schemas/stage1.book-blueprint.schema.json",
  "title": "Stage1 Book Blueprint",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "meta",
    "book_intent",
    "theme_catalog",
    "episode_plan",
    "coverage_matrix",
    "continuity_plan",
    "quality_checks"
  ],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "book_title",
        "audience_background",
        "audience_level",
        "audience_interest",
        "baseline_context_or_empty",
        "existing_audio_script_dir_or_empty",
        "episode_duration_target"
      ],
      "properties": {
        "book_title": {
          "type": "string",
          "minLength": 1
        },
        "audience_background": {
          "type": "string"
        },
        "audience_level": {
          "type": "string"
        },
        "audience_interest": {
          "type": "string"
        },
        "baseline_context_or_empty": {
          "type": "string"
        },
        "existing_audio_script_dir_or_empty": {
          "type": "string"
        },
        "episode_duration_target": {
          "type": "string",
          "const": "10-12min"
        }
      }
    },
    "book_intent": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "primary_message",
        "learning_outcomes"
      ],
      "properties": {
        "primary_message": {
          "type": "string",
          "minLength": 1
        },
        "learning_outcomes": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "theme_catalog": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "theme_id",
          "theme_title",
          "theme_summary",
          "chapter_refs",
          "prerequisite_theme_ids",
          "importance"
        ],
        "properties": {
          "theme_id": {
            "type": "string",
            "pattern": "^T[0-9]{2}$"
          },
          "theme_title": {
            "type": "string",
            "minLength": 1
          },
          "theme_summary": {
            "type": "string",
            "minLength": 1
          },
          "chapter_refs": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "minLength": 1
            }
          },
          "prerequisite_theme_ids": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^T[0-9]{2}$"
            }
          },
          "importance": {
            "type": "string",
            "enum": [
              "HIGH",
              "MEDIUM",
              "LOW"
            ]
          }
        }
      }
    },
    "episode_plan": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "episode_id",
          "episode_title",
          "target_theme_ids",
          "learning_goal",
          "source_refs",
          "scope_guardrails",
          "comparison_mode_default"
        ],
        "properties": {
          "episode_id": {
            "type": "string",
            "pattern": "^E[0-9]{2}$"
          },
          "episode_title": {
            "type": "string",
            "minLength": 1
          },
          "target_theme_ids": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "pattern": "^T[0-9]{2}$"
            }
          },
          "learning_goal": {
            "type": "string",
            "minLength": 1
          },
          "source_refs": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "minLength": 1
            }
          },
          "scope_guardrails": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            }
          },
          "comparison_mode_default": {
            "type": "string",
            "enum": [
              "with_baseline",
              "standalone"
            ]
          }
        }
      }
    },
    "coverage_matrix": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "chapters",
        "themes"
      ],
      "properties": {
        "chapters": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "chapter_ref",
              "covered_by_episode_ids",
              "covered_theme_ids"
            ],
            "properties": {
              "chapter_ref": {
                "type": "string",
                "minLength": 1
              },
              "covered_by_episode_ids": {
                "type": "array",
                "items": {
                  "type": "string",
                  "pattern": "^E[0-9]{2}$"
                }
              },
              "covered_theme_ids": {
                "type": "array",
                "items": {
                  "type": "string",
                  "pattern": "^T[0-9]{2}$"
                }
              }
            }
          }
        },
        "themes": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "theme_id",
              "covered_by_episode_ids"
            ],
            "properties": {
              "theme_id": {
                "type": "string",
                "pattern": "^T[0-9]{2}$"
              },
              "covered_by_episode_ids": {
                "type": "array",
                "items": {
                  "type": "string",
                  "pattern": "^E[0-9]{2}$"
                }
              }
            }
          }
        }
      }
    },
    "continuity_plan": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "existing_episode_ids_if_any",
        "overlap_risk_summary",
        "reuse_or_rewrite_recommendations"
      ],
      "properties": {
        "existing_episode_ids_if_any": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^E[0-9]{2}$"
          }
        },
        "overlap_risk_summary": {
          "type": "string",
          "enum": [
            "LOW",
            "MEDIUM",
            "HIGH",
            "N/A"
          ]
        },
        "reuse_or_rewrite_recommendations": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "quality_checks": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "chapter_coverage_complete",
        "theme_coverage_complete",
        "dependency_order_valid",
        "episode_granularity_valid",
        "known_gaps"
      ],
      "properties": {
        "chapter_coverage_complete": {
          "type": "string",
          "enum": [
            "OK",
            "NG"
          ]
        },
        "theme_coverage_complete": {
          "type": "string",
          "enum": [
            "OK",
            "NG"
          ]
        },
        "dependency_order_valid": {
          "type": "string",
          "enum": [
            "OK",
            "NG"
          ]
        },
        "episode_granularity_valid": {
          "type": "string",
          "enum": [
            "OK",
            "NG"
          ]
        },
        "known_gaps": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
